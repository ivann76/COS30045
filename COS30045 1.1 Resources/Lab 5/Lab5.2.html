<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Data Visualisation" />
    <meta name="keywords" content="HTML, CSS, D3" />
    <meta name="author" content="Ivan" />

    <title>Task 5.1 D3 Updates</title>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .axis {
            font: 10px sans-serif;
        }

        .title{
            padding: 20px;
        }

        button {
            margin-right: 10px;
        }
    </style>
</head>

<body>
    <div class="title">
        <h1 style="font-family: 'Times New Roman', Times, serif;">Update and Transitions</h1>
        <button id="update" style="background-color: lightblue; border-radius: 5px; padding: 3px;">Update Data</button>
        <button id="elastic" style="background-color: lightgreen; border-radius: 5px; padding: 3px;">Elastic Transition</button>
        <button id="circle" style="background-color: lightcoral; border-radius: 5px; padding: 3px;">Circle Transition</button>
    </div>

    <div>
        <svg id="chart" width="500" height="300"></svg>
    </div>
    
    <script>
        var w = 500;  // Width of the SVG element
        var h = 300;  // Height of the SVG element

        // Initial dataset
        var dataset = generateRandomData(10);

        // Create the SVG element
        var svg = d3.select("#chart");

        var currentEase = d3.easeCubicInOut; // Default easing function

        // Function to create/update the bar chart
        function drawChart(data) {
            // Set up scales
            var xScale = d3.scaleBand()
                .domain(d3.range(data.length))
                .rangeRound([0, w])
                .paddingInner(0.05);
                
            var yScale = d3.scaleLinear()
                .domain([0, d3.max(data) + 5]) // Add extra space equivalent to 5 units above the maximum value
                .range([h - 30, 0]); // Increase padding at the top


            // Bind data to rects
            var bars = svg.selectAll("rect")
                .data(data);

            // Enter selection
            bars.enter()
                .append("rect")
                .attr("fill", "steelblue")
                .merge(bars)  // Merge with update selection
                .transition() // Add transition for smoother updates
                .duration(2000) // Extend the duration to 2000ms
                .ease(currentEase) // Use the current easing function
                .delay((d, i) => i * 100) // Stagger the transition by index
                .attr("x", (d, i) => xScale(i))
                .attr("y", d => yScale(d))
                .attr("width", xScale.bandwidth())
                .attr("height", d => h - yScale(d));

            // Exit selection
            bars.exit().remove();

            // Add numbers above the bars
            var labels = svg.selectAll("text")
                .data(data);

            labels.enter()
                .append("text")
                .merge(labels)
                .transition()
                .duration(2000)
                .ease(currentEase)
                .delay((d, i) => i * 100)
                .text(d => d)
                .attr("x", (d, i) => xScale(i) + xScale.bandwidth() / 2)
                .attr("y", d => yScale(d) - 5)
                .attr("text-anchor", "middle")
                .attr("fill", function(d) {
                    return yScale(d) > (h - 20) ? "white" : "black"; // White text for high bars
                })
                .style("font-size", "12px");

            labels.exit().remove();

        }

        // Function to generate random data
        function generateRandomData(num) {
            var maxValue = 25; // Max random value
            return Array.from({length: num}, () => Math.floor(Math.random() * maxValue));
        }

        // Initial draw
        drawChart(dataset);

        // Update data on button click
        d3.select("#update").on("click", function() {
            dataset = generateRandomData(10); // Generate new random dataset
            drawChart(dataset); // Redraw chart with new data
        });

        // Elastic transition button
        d3.select("#elastic").on("click", function() {
            currentEase = d3.easeElasticOut;
            dataset = generateRandomData(10);
            drawChart(dataset);
        });

        // Circle transition button
        d3.select("#circle").on("click", function() {
            currentEase = d3.easeCircleIn;
            dataset = generateRandomData(10);
            drawChart(dataset);
        });

        // Footer style
        d3.select("body")
            .append("footer")
            .style("color", "grey")
            .html("COS30045 Data Visualisation<br>Joe Bloggs");
    </script>

</body>

</html>
